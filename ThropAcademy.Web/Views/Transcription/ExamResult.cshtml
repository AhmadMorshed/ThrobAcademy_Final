@model Throb.Data.Entities.ExamRequestModel
@{
    ViewData["Title"] = "نتيجة الاختبار - Throb Academy";

    // جلب البيانات من ViewBag التي أرسلها الكنترولر
    // قمنا باستخدام (double) للسكور لضمان دقة العملية الحسابية للنسبة المئوية
    double score = Convert.ToDouble(ViewBag.Score ?? 0);
    int totalQuestions = Convert.ToInt32(ViewBag.Total ?? 0);
    double percentage = Convert.ToDouble(ViewBag.Percentage ?? 0);

    // تحديد حالة النجاح (70% فأعلى)
    bool isPassed = percentage >= 70;
}

<div class="result-horizontal-wrapper">
    <div class="result-main-card animate-fade-in shadow-lg">
        <div class="row g-0">
            @* الجزء الجانبي: يتغير لونه بناءً على حالة النجاح *@
            <div class="col-lg-5 text-center p-5 side-panel @(isPassed ? "pass-bg" : "fail-bg")">
                <div class="status-badge mb-3">@(isPassed ? "تم الاجتياز بنجاح" : "محاولة غير موفقة")</div>

                <div class="percentage-box">
                    @* نمرر النسبة المئوية لمتغيرات CSS ليقوم الـ JS والـ CSS برسمها *@
                    <div class="circular-progress-modern"
                         style="--p:@((int)percentage); --c:@(isPassed ? "#10b981" : "#ef4444");">
                        <div class="inner-content">
                            <span class="percent-number">@percentage%</span>
                            <span class="label">معدل الإنجاز</span>
                        </div>
                    </div>
                </div>

                <div class="status-icon-box mt-4">
                    <i class="bi @(isPassed ? "bi-award-fill" : "bi-exclamation-octagon-fill")"></i>
                </div>
            </div>

            @* الجزء الأيمن: تحليل البيانات *@
            <div class="col-lg-7 p-5 d-flex flex-column justify-content-center">
                <div class="result-content text-end">
                    @* أضفنا text-end لتناسب اللغة العربية *@
                    <h2 class="fw-black mb-1">تحليل الأداء الذكي</h2>
                    <p class="text-muted mb-4 small">أكاديمية Throb - نظام التقييم التلقائي</p>

                    <div class="stats-grid mb-4">
                        <div class="stat-card">
                            <span class="stat-label">الإجابات الصحيحة</span>
                            <span class="stat-value text-success">@score</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-label">إجمالي الأسئلة</span>
                            <span class="stat-value text-primary">@totalQuestions</span>
                        </div>
                    </div>

                    <div class="feedback-box @(isPassed ? "fb-success" : "fb-danger") mb-5">
                        <h5 class="fw-bold mb-1">
                            @(percentage >= 90 ? "أداء استثنائي! ✨" : isPassed ? "عمل رائع! ✅" : "لا تيأس، حاول مجدداً 💡")
                        </h5>
                        <p class="mb-0 small opacity-75">
                            @(isPassed ? "لقد أثبتّ تمكنك من المادة العلمية بنجاح." : "نوصي بمراجعة الدروس التي تعثرت بها قبل المحاولة القادمة.")
                        </p>
                    </div>

                    <div class="actions-row d-flex gap-3">
                        @* <a href="@Url.Action("UploadMedia", "Transcription")" class="btn-action-primary flex-grow-1 text-center">
                            <i class="bi bi-arrow-repeat me-2"></i> محاولة جديدة
                        </a> *@
                        <button onclick="window.print()" class="btn-print-premium">
                            <span class="icon-wrapper">
                                <i class="bi bi-printer-fill"></i>
                            </span>
                            <span class="btn-text">طباعة </span>
                            <div class="btn-shine"></div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="~/css/Transcription/ExamResult.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/js/Transcription/ExamResult.js" asp-append-version="true"></script>
}