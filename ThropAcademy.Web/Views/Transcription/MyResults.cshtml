@model IEnumerable<Throb.Data.Entities.UserExamResult>
@{
    ViewData["Title"] = "سجل إنجازاتي";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<div class="container py-5" style="direction: rtl;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold" style="color: #4f46e5;">سجل النتائج والاختبارات</h2>
            <p class="text-muted">هنا يمكنك متابعة تطورك الأكاديمي ونتائج اختباراتك الذكية</p>
        </div>
        <i class="bi bi-trophy-fill text-warning" style="font-size: 3rem;"></i>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5 shadow-sm rounded-4 bg-white">
            <i class="bi bi-clipboard-x text-muted" style="font-size: 4rem;"></i>
            <h4 class="mt-3">لا توجد نتائج مسجلة بعد</h4>
            <p>ابدأ رحلتك التعليمية وقم بتقديم أول اختبار لك الآن!</p>
            <a href="@Url.Action("UploadMedia", "Transcription")" class="btn btn-primary px-4 rounded-pill">ابدأ الآن</a>
        </div>
    }
    else
    {
        <div class="table-responsive shadow-lg rounded-4 overflow-hidden bg-white">
            <table class="table table-hover align-middle mb-0">
                <thead style="background-color: #f8fafc;">
                    <tr>
                        <th class="p-4">نوع الاختبار</th>
                        <th>التاريخ</th>
                        <th>الإجابات</th>
                        <th>النسبة المئوية</th>
                        <th>الحالة</th>
                        <th>إجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        var isPassed = item.ScorePercentage >= 70;
                        <tr>
                            <td class="p-4">
                                <div class="d-flex align-items-center">
                                    <div class="icon-box me-3 @(item.ExamType == "Final" ? "bg-primary-subtle" : "bg-info-subtle")"
                                         style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                                        <i class="bi @(item.ExamType == "Final" ? "bi-mortarboard" : "bi-lightning") text-primary"></i>
                                    </div>
                                    <span class="fw-bold">
                                        @(item.ExamType == "Final" ? "Final" :
                                                                        item.ExamType == "Quiz" ? "Quiz" : item.ExamType == "Practical" ? "Practical" : "")
                            </span>
                                </div>
                            </td>
                            <td>@item.CompletedAt.ToString("yyyy/MM/dd")</td>
                            <td>
                                <span class="badge rounded-pill bg-light text-dark border">
                                    @item.CorrectAnswers من @item.TotalQuestions
                                </span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="progress flex-grow-1 me-2" style="height: 6px; width: 80px;">
                                        <div class="progress-bar @(isPassed ? "bg-success" : "bg-danger")"
                                             style="width: @item.ScorePercentage%"></div>
                                    </div>
                                    <span class="fw-bold">@item.ScorePercentage%</span>
                                </div>
                            </td>
                            <td>
                                @if (isPassed)
                                {
                                    <span class="badge bg-success-subtle text-success border border-success-subtle px-3 py-2">
                                        <i class="bi bi-check-circle-fill me-1"></i> ناجح
                                    </span>
                                }
                                else
                                {
                                    <span class="badge bg-danger-subtle text-danger border border-danger-subtle px-3 py-2">
                                        <i class="bi bi-x-circle-fill me-1"></i> لم يجتز
                                    </span>
                                }
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-secondary rounded-pill">
                                    <i class="bi bi-eye"></i> التفاصيل
                                </button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>