@model IEnumerable<Throb.Data.Entities.UserExamResult>
@{
    ViewData["Title"] = "سجل إنجازاتي";
    // تقسيم البيانات برمجياً لسهولة الوصول إليها
    var finalExams = Model.Where(x => x.ExamType == "Final").OrderByDescending(x => x.CompletedAt);
    var quizExams = Model.Where(x => x.ExamType == "Quiz").OrderByDescending(x => x.CompletedAt);
    var practicalExams = Model.Where(x => x.ExamType == "Practical").OrderByDescending(x => x.CompletedAt);
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
    .nav-pills .nav-link {
        color: #64748b;
        font-weight: 600;
        border-radius: 12px;
        padding: 10px 25px;
        transition: all 0.3s ease;
    }

        .nav-pills .nav-link.active {
            background-color: #4f46e5 !important;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

    .card-stat {
        border: none;
        border-radius: 15px;
        transition: transform 0.3s ease;
    }

        .card-stat:hover {
            transform: translateY(-5px);
        }
</style>

<div class="container py-5" style="direction: rtl; text-align: right;">
    @* رأس الصفحة *@
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-bold" style="color: #1e293b;">سجل النتائج والاختبارات</h2>
            <p class="text-muted">نظرة شاملة على مسيرتك التعليمية مقسمة حسب نوع التقييم</p>
        </div>
        <div class="d-none d-md-block">
            <i class="bi bi-award-fill text-primary" style="font-size: 3.5rem; opacity: 0.2;"></i>
        </div>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5 shadow-sm rounded-4 bg-white">
            <i class="bi bi-clipboard-x text-muted" style="font-size: 4rem;"></i>
            <h4 class="mt-3">لا توجد نتائج مسجلة بعد</h4>
            <a href="@Url.Action("AvailableExams", "Exam")" class="btn btn-primary px-4 rounded-pill mt-3">استعرض الاختبارات المتاحة</a>
        </div>
    }
    else
    {
        @* نظام التبويبات (Tabs) *@
        <ul class="nav nav-pills mb-4 g-3 justify-content-center justify-content-md-start" id="examTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active me-2" id="all-tab" data-bs-toggle="pill" data-bs-target="#all" type="button" role="tab">
                    الكل (@Model.Count())
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link me-2" id="final-tab" data-bs-toggle="pill" data-bs-target="#final" type="button" role="tab">
                    الاختبارات النهائية (@finalExams.Count())
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link me-2" id="quiz-tab" data-bs-toggle="pill" data-bs-target="#quiz" type="button" role="tab">
                    الكويزات (@quizExams.Count())
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="practical-tab" data-bs-toggle="pill" data-bs-target="#practical" type="button" role="tab">
                    التطبيقات العملية (@practicalExams.Count())
                </button>
            </li>
        </ul>

        <div class="tab-content" id="examTabsContent">
            @* تبويب الكل *@
            <div class="tab-pane fade show active" id="all" role="tabpanel">
                @await Html.PartialAsync("_ExamTablePartial", Model)
            </div>

            @* تبويب النهائية *@
            <div class="tab-pane fade" id="final" role="tabpanel">
                @if (finalExams.Any())
                {
                    @await Html.PartialAsync("_ExamTablePartial", finalExams)
                }
                else
                {

                    <p class="text-center py-5 text-muted">لا توجد اختبارات نهائية مسجلة</p>
                }
            </div>

            @* تبويب الكويزات *@
            <div class="tab-pane fade" id="quiz" role="tabpanel">
                @if (quizExams.Any())
                {
                    @await Html.PartialAsync("_ExamTablePartial", quizExams)
                }
                else
                {

                    <p class="text-center py-5 text-muted">لا توجد كويزات مسجلة</p>
                }
            </div>

            @* تبويب العملي *@
            <div class="tab-pane fade" id="practical" role="tabpanel">
                @if (practicalExams.Any())
                {
                    @await Html.PartialAsync("_ExamTablePartial", practicalExams)
                }
                else
                {

                    <p class="text-center py-5 text-muted">لا توجد تطبيقات عملية مسجلة</p>
                }
            </div>
        </div>
    }
</div>